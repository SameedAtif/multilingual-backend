<%= form_with model: @message, id: "send-message-form" do |f| %>
<%= f.hidden_field :room_id, value: @message.room.id %>
<%= f.hidden_field :message_on_enter_key, value: current_user.message_on_enter_key, class: "js-message-on-enter-key" %>

<div class="flex flex-row items-center p-4">
  <div class="flex flex-row items-center w-full border rounded-3xl h-12 px-2">
    <div class="w-full">
      <%= f.text_area :source_text,
        class:"border border-transparent w-full text-sm h-10 flex items-center",
        placeholder:"Type your message....",
        id: "message-input"
      %>
    </div>
    <%# <div class="flex flex-row">
      <button class="flex items-center justify-center h-10 w-8 text-gray-400">
        <svg class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
        </svg>
      </button>
      <button class="flex items-center justify-center h-10 w-8 text-gray-400 ml-1 mr-2">
        <svg class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
      </button>
    </div> %>
  </div>
  <div class="ml-6">
    <button type="submit" id="send-button" class="flex items-center justify-center h-10 w-10 rounded-full bg-gray-600 hover:bg-black text-indigo-800 text-white">
      <svg class="w-5 h-5 transform rotate-90 -mr-px"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
      </svg>
    </button>
  </div>
</div>
<%end %>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("send-message-form");
    const input = document.getElementById("message-input");
    const sendButton = document.getElementById("send-button");
    const messageOnEnterKey = form.querySelector('.js-message-on-enter-key').value === 'true';


    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        if (e.shiftKey) {
          // Shift + Enter always adds a new line
          return;
        }sendButton

        if (messageOnEnterKey) {
          // Prevent the newline and submit the form
          e.preventDefault();
          form.requestSubmit();
        } else {
          // Let the newline happen naturally
          return;
        }
      }
    });
  });
</script>
